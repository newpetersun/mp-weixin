"use strict";const t=require("../../common/vendor.js"),a=require("../../config/config.js"),e=require("../../utils/api.js"),o={data:()=>({showContactModal:!1,loading:!1,error:null,contactInfo:{},contactForm:{email:"",wechat:"",qq:"",address:"",github:""},stats:{},recentMessages:[]}),methods:{getStaticUrl:t=>a.CONFIG_UTILS.getStaticUrl(t),goBack(){t.index.navigateBack()},editContact(){this.contactForm={...this.contactInfo},this.showContactModal=!0},closeContactModal(){this.showContactModal=!1},saveContact(){this.contactInfo={...this.contactForm},this.closeContactModal(),t.index.showToast({title:"保存成功",icon:"success"})},viewAllMessages(){t.index.navigateTo({url:"/pages/admin/message"})},async loadContactData(){this.loading=!0,this.error=null;try{const[t,a,o]=await Promise.all([e.ApiService.contact.getInfo(),e.ApiService.contact.getStats(),e.ApiService.contact.getMessages({limit:5})]);console.log("联系信息:",t),console.log("统计数据:",a),console.log("最近留言:",o),this.contactInfo=t,this.stats={totalMessages:a.total_messages||0,unreadMessages:a.unread_messages||0,todayVisits:a.today_messages||0},this.recentMessages=(o.list||o).map((t=>({id:t.id,name:t.name,email:t.email,content:t.message||t.subject,time:this.formatTime(t.create_time),read:1===t.is_read})))}catch(t){this.error=t.message||"数据加载失败",e.ApiErrorHandler.handle(t)}finally{this.loading=!1}},async saveContact(){try{await e.ApiService.contact.update(this.contactForm),this.contactInfo={...this.contactForm},this.closeContactModal(),t.index.showToast({title:"保存成功",icon:"success"})}catch(a){e.ApiErrorHandler.handle(a)}},formatTime(t){if(!t)return"未知时间";const a=new Date(t),e=new Date-a;return e<6e4?"刚刚":e<36e5?Math.floor(e/6e4)+"分钟前":e<864e5?Math.floor(e/36e5)+"小时前":e<6048e5?Math.floor(e/864e5)+"天前":a.toLocaleDateString()}},onLoad(){const a=t.index.getStorageSync("wechat_token"),e=t.index.getStorageSync("userInfo");return a&&e?"admin"!==e.user_type?(t.index.showToast({title:"无管理员权限",icon:"none",duration:2e3}),void setTimeout((()=>{t.index.redirectTo({url:"/pages/index/index"})}),2e3)):void this.loadContactData():(t.index.showToast({title:"请先登录",icon:"none",duration:2e3}),void setTimeout((()=>{t.index.redirectTo({url:"/pages/index/index"})}),2e3))},onShow(){this.loadContactData()}};const s=t._export_sfc(o,[["render",function(a,e,o,s,c,n){return t.e({a:n.getStaticUrl("/static/svg/left.svg"),b:t.o(((...t)=>n.goBack&&n.goBack(...t))),c:t.o(((...t)=>n.editContact&&n.editContact(...t))),d:c.loading},c.loading?{}:c.error?{f:t.t(c.error),g:t.o(((...t)=>n.loadContactData&&n.loadContactData(...t)))}:{h:n.getStaticUrl("/static/svg/email.svg"),i:t.t(c.contactInfo.email),j:n.getStaticUrl("/static/svg/wechat.svg"),k:t.t(c.contactInfo.wechat),l:n.getStaticUrl("/static/svg/qq.svg"),m:t.t(c.contactInfo.qq),n:n.getStaticUrl("/static/svg/local.svg"),o:t.t(c.contactInfo.address),p:n.getStaticUrl("/static/svg/github.svg"),q:t.t(c.contactInfo.github),r:n.getStaticUrl("/static/svg/message-emoji.svg"),s:t.t(c.stats.totalMessages),t:n.getStaticUrl("/static/svg/message-unread.svg"),v:t.t(c.stats.unreadMessages),w:n.getStaticUrl("/static/svg/eye.svg"),x:t.t(c.stats.todayVisits),y:t.o(((...t)=>n.viewAllMessages&&n.viewAllMessages(...t))),z:t.f(c.recentMessages,((a,e,o)=>({a:t.t(a.name),b:t.t(a.time),c:t.t(a.content),d:t.t(a.email),e:t.t(a.read?"已读":"未读"),f:t.n(a.read?"status-read":"status-unread"),g:a.id}))),A:n.getStaticUrl("/static/images/default-avatar.jpg")},{e:c.error,B:c.showContactModal},c.showContactModal?{C:t.o(((...t)=>n.closeContactModal&&n.closeContactModal(...t))),D:c.contactForm.email,E:t.o((t=>c.contactForm.email=t.detail.value)),F:c.contactForm.wechat,G:t.o((t=>c.contactForm.wechat=t.detail.value)),H:c.contactForm.qq,I:t.o((t=>c.contactForm.qq=t.detail.value)),J:c.contactForm.address,K:t.o((t=>c.contactForm.address=t.detail.value)),L:c.contactForm.github,M:t.o((t=>c.contactForm.github=t.detail.value)),N:t.o(((...t)=>n.closeContactModal&&n.closeContactModal(...t))),O:t.o(((...t)=>n.saveContact&&n.saveContact(...t))),P:t.o((()=>{})),Q:t.o(((...t)=>n.closeContactModal&&n.closeContactModal(...t)))}:{})}]]);wx.createPage(s);
