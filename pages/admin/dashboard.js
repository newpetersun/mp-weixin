"use strict";const e=require("../../common/vendor.js"),t=require("../../config/config.js"),o=require("../../utils/api.js"),a={data:()=>({userInfo:{username:"admin"},showLogoutModal:!1,loading:!1,error:null,statsData:[{key:"projects",label:"总项目数",value:"12",color:"#3348e7",icon:"/static/svg/project.svg"},{key:"messages",label:"未读留言",value:"5",color:"#10b981",icon:"/static/svg/message-unread.svg"},{key:"visits",label:"今日访问",value:"128",color:"#f59e0b",icon:"/static/svg/eye.svg"},{key:"users",label:"注册用户",value:"1,234",color:"#ef4444",icon:"/static/svg/user.svg"}],modulesData:[{key:"user",title:"用户管理",description:"管理用户信息和权限",path:"/pages/admin/user",color:"#3348e7",icon:"/static/svg/user.svg"},{key:"project",title:"项目管理",description:"管理项目内容和分类",path:"/pages/admin/project",color:"#10b981",icon:"/static/svg/project.svg"},{key:"technology",title:"技术管理",description:"管理技术栈和技能标签",path:"/pages/admin/technology",color:"#f97316",icon:"/static/svg/html5.svg"},{key:"contact",title:"联系管理",description:"管理联系信息和留言",path:"/pages/admin/contact",color:"#f59e0b",icon:"/static/svg/message-security.svg"},{key:"message",title:"留言管理",description:"查看和处理用户留言",path:"/pages/admin/message",color:"#ef4444",icon:"/static/svg/message-emoji.svg"},{key:"category",title:"分类管理",description:"管理项目分类设置",path:"/pages/admin/category",color:"#8b5cf6",icon:"/static/svg/category.svg"},{key:"setting",title:"系统设置",description:"配置系统参数和选项",path:"/pages/admin/setting",color:"#9333ea",icon:"/static/svg/config.svg"},{key:"analytics",title:"数据分析",description:"查看统计报表和图表",path:"/pages/admin/analytics",color:"#06b6d4",icon:"/static/svg/analysis.svg"},{key:"progress",title:"项目进度",description:"管理项目需求和开发进度",path:"/pages/admin/progress",color:"#059669",icon:"/static/svg/radar.svg"}],recentActivities:[]}),methods:{getStaticUrl:e=>t.CONFIG_UTILS.getStaticUrl(e),goBack(){e.index.navigateBack()},navigateToModule(t){e.index.navigateTo({url:t})},handleLogout(){this.showLogoutModal=!0},cancelLogout(){this.showLogoutModal=!1},confirmLogout(){e.index.removeStorageSync("wechat_token"),e.index.removeStorageSync("userInfo"),e.index.showToast({title:"已退出登录",icon:"success",duration:2e3}),setTimeout((()=>{e.index.redirectTo({url:"/pages/index/index"})}),2e3)},async loadDashboardData(){this.loading=!0,this.error=null;try{const[e,t,a]=await Promise.all([o.ApiService.admin.getDashboard(),o.ApiService.admin.getStats(),o.ApiService.admin.getVisitTrend(7)]);this.updateStatsData(e,t),this.recentActivities=e.recent_activities||[]}catch(e){this.error=e.message||"数据加载失败",o.ApiErrorHandler.handle(e)}finally{this.loading=!1}},updateStatsData(e,t){const o=this.statsData.find((e=>"projects"===e.key));o&&t.projects&&(o.value=t.projects.total||"0");const a=this.statsData.find((e=>"messages"===e.key));a&&t.messages&&(a.value=t.messages.unread||"0");const s=this.statsData.find((e=>"visits"===e.key));s&&t.visits&&(s.value=t.visits.today||"0");const i=this.statsData.find((e=>"users"===e.key));i&&t.users&&(i.value=t.users.total||"0")}},onLoad(){const t=e.index.getStorageSync("wechat_token"),o=e.index.getStorageSync("userInfo");return console.log("wechat_token:",t),console.log("userInfo:",o),t&&o?"admin"!==o.user_type?(e.index.showToast({title:"无管理员权限",icon:"none",duration:2e3}),void setTimeout((()=>{e.index.redirectTo({url:"/pages/index/index"})}),2e3)):(this.userInfo=o,void this.loadDashboardData()):(e.index.showToast({title:"请先登录",icon:"none",duration:2e3}),void setTimeout((()=>{e.index.redirectTo({url:"/pages/index/index"})}),2e3))},onShow(){this.loadDashboardData()}};const s=e._export_sfc(a,[["render",function(t,o,a,s,i,c){return e.e({a:c.getStaticUrl("/static/svg/left.svg"),b:e.o(((...e)=>c.goBack&&c.goBack(...e))),c:e.o(((...e)=>c.handleLogout&&c.handleLogout(...e))),d:i.loading},i.loading?{}:i.error?{f:e.t(i.error),g:e.o(((...e)=>c.loadDashboardData&&c.loadDashboardData(...e)))}:{h:e.f(i.statsData,((t,o,a)=>({a:c.getStaticUrl(t.icon),b:t.color,c:e.t(t.value),d:e.t(t.label),e:t.key}))),i:e.f(i.modulesData,((t,o,a)=>({a:c.getStaticUrl(t.icon),b:t.color,c:e.t(t.title),d:e.t(t.description),e:t.key,f:e.o((e=>c.navigateToModule(t.path)),t.key)}))),j:e.f(i.recentActivities,((t,o,a)=>({a:c.getStaticUrl(t.icon),b:t.color,c:e.t(t.title),d:e.t(t.time),e:t.id})))},{e:i.error,k:i.showLogoutModal},i.showLogoutModal?{l:e.o(((...e)=>c.cancelLogout&&c.cancelLogout(...e))),m:e.o(((...e)=>c.cancelLogout&&c.cancelLogout(...e))),n:e.o(((...e)=>c.confirmLogout&&c.confirmLogout(...e))),o:e.o((()=>{})),p:e.o(((...e)=>c.cancelLogout&&c.cancelLogout(...e)))}:{})}]]);wx.createPage(s);
