"use strict";const t=require("../../../utils/api.js"),e=require("../../../common/vendor.js"),a={name:"Accessstatistics",data:()=>({visitChartData:{categories:[],series:[]},visitChartOpts:{color:[],padding:[0,0,0,0],enableScroll:!1,dataLabel:!1,dataPointShape:!1,legend:{show:!0,position:"top",float:"center",fontSize:10},xAxis:{disableGrid:!0,boundaryGap:"center"},yAxis:{disabled:!0,disableGrid:!0,dashLength:2,data:[{min:0}]},extra:{line:{type:"curve",width:2,activeType:"none",linearType:!0,animation:"horizontal"},tooltip:{showBox:!0}}},visitTrend:[],visitTrendChange:0}),mounted(){this.loadData()},methods:{async loadData(){console.log("访问统计组件已加载");try{const[e]=await Promise.all([t.ApiService.visit.getTrend(7)]);this.visitTrend=e||[],this.getServerData()}catch(e){t.ApiErrorHandler.handle(e),setTimeout((()=>{this.loadings=!1}),1e3)}},getServerData(){try{if(this.visitTrend&&this.visitTrend.length>0){const t=[...this.visitTrend].sort(((t,e)=>new Date(t.date)-new Date(e.date))),e=t.map((t=>{const e=new Date(t.date);return`${e.getMonth()+1}-${e.getDate()}`})),a=t.map((t=>t.visits||0)),i=t.map((t=>t.visitors||0));this.calculateVisitTrendChange(t),this.visitChartData={categories:e,series:[{name:"访问量",data:a,linearColor:[[0,"#1890FF"],[.25,"#00B5FF"],[.5,"#00D1ED"],[.75,"#00E6BB"],[1,"#90F489"]]},{name:"访客",data:i,linearColor:[[0,"#FAC858"],[.33,"#FFC371"],[.66,"#FFC2B2"],[1,"#FA7D8D"]]}]}}else this.visitChartData={categories:["31","1","2","3","4","5","6","7","8","9"],series:[{name:"访问量",data:[5,8,15,10,25,20,30,27,40,16],linearColor:[[0,"#1890FF"],[.25,"#00B5FF"],[.5,"#00D1ED"],[.75,"#00E6BB"],[1,"#90F489"]]}]};console.log("访问统计图表数据已更新")}catch(t){console.error("访问统计图表数据处理失败:",t)}},calculateVisitTrendChange(t){if(!t||t.length<2)return void(this.visitTrendChange=0);const e=[...t];e.length>7&&e.splice(0,e.length-7);let a=0,i=0;for(let s=1;s<e.length;s++){const t=e[s-1].count||0,n=e[s].count||0;if(t>0){a+=(n-t)/t*100,i++}}this.visitTrendChange=i>0?Math.round(a/i):0}}};if(!Array){e.resolveComponent("qiun-data-charts")()}Math;const i=e._export_sfc(a,[["render",function(t,a,i,s,n,r){return{a:e.p({type:"line",opts:n.visitChartOpts,chartData:n.visitChartData,canvasId:"visitChart",canvas2d:!0})}}]]);wx.createComponent(i);
